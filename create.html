 <html>  
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="icon" href="dk.png">
    <title>Laporan SPJ CV. Bisma Indonesia</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css" >
</head>  
<body>
  <nav class="navbar navbar-dark bg-primary">
    <a class="navbar-brand text-white" href="">
      CV. Bisma Indonesia
    </a>
  </nav>

  <h2 align="center" style="margin: 20px;">Buat Laporan</h2>

  <div class="container">
    <div class="row">
      <div class="col-sm-4 mb-4">
        <div class="card">
          <div class="card-header bg-info text-white">
            Data Pelanggan
          </div>
          <div class="card-body">
            <input type="text" name="date" class="form-control npsn" placeholder="00000000" readonly>
            <label></label>
            <input type="text" name="nama" class="form-control" placeholder="Nama Lembaga" readonly>
            <label></label>
            <input type="text" name="alamat" class="form-control" placeholder="Alamat Lembaga" readonly>
            <label></label>
            <input type="text" name="kec" class="form-control" placeholder="Kecamatan" readonly>
            <label></label>
            <input type="text" name="kab" class="form-control" placeholder="Kabupaten" readonly>
            <label></label>
            <input type="text" name="prop" class="form-control" placeholder="Propinsi" readonly>
            <label></label>
            <input type="text" name="pos" class="form-control pos" placeholder="00000" readonly>
            <label></label>
            <input type="text" name="pic" class="form-control" placeholder="Nama User" readonly>
            <label></label>
            <input type="text" name="jabatan" class="form-control" placeholder="Jabatan" readonly>
            <label></label>
            <input type="text" name="nip" class="form-control nip" placeholder="NIP" readonly>
            <label></label>
            <input type="text" name="tlp" class="form-control tlp" placeholder="08XXXXXXXXXX" readonly>

            <hr>
            <button type="button" class="btn btn-primary datapelanggan" data-href="cari.html" data-toggle="modal" data-target="#exampleModalCenter">
              Pilih Data Pelanggan
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    ...
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                  </div>
                </div>
              </div>
            </div>


          </div>

        </div>
      </div>
      <div class="col-sm-8 mb-4">
        <div class="card">
          <div class="card-header bg-info text-white">
            Form Pesanan
          </div>
          <div class="card-body">
            
            <label>Tanggal PO</label>
            <input type="text" name="nip" class="form-control date" placeholder="00/00/0000">
            <label>Tanggal SPK</label>
            <input type="text" name="nip" class="form-control date" placeholder="00/00/0000">
            <label>Tanggal BAST</label>
            <input type="text" name="nip" class="form-control date" placeholder="00/00/0000">

            <hr>

              <label>Download template table pesanan <a href="contoh.xlsx">contoh.xlsx</a></label>

            <div class="input-group mb-3">
            <div class="custom-file">
              <input type="file" id="input" name="file" placeholder="Pilih File" />
            </div>
          </div>

          <div id="rs-table"></div>

          <script>
                  var input = document.getElementById('input')

                  input.addEventListener('change', function() {
                    readXlsxFile(input.files[0]).then(function(data) {

                      var jumlah = 0;
                      for(i=1;i<data.length;i++){
                        jumlah = jumlah + data[i][4];
                      }

                    document.getElementById('rs-table').innerHTML =
                      '<table id="result-table">' +
                      '<tbody>' +
                      data.map(function (row) {
                        return '<tr>' + row.map(function (dcell) {
                            return '<td>' + ( dcell === null ? '' : (isNaN(dcell) ? dcell : (Math.round(dcell * 100) / 100).toLocaleString() ) ) + '</td>'
                          }).join('') + '</tr>' }).join('') + '</tbody>' + '</table>' +
                      
                      '<label style="color: black; text-align: right; width: 100%; margin-top:10px;">Total : Rp. '+ Math.round((jumlah * 100) / 100).toLocaleString() +'</label>'

                      
                      
                      //dataTable.header = data.shift();
                      //dataTable.data = data;
                      
                      function arrayToJSONObject (arr){
                        //header
                        var keys = arr[0];

                        //vacate keys from main array
                        var newArr = arr.slice(1, arr.length);

                        var formatted = [],
                        data = newArr,
                        cols = keys,
                        l = cols.length;
                        for (var i=0; i<data.length; i++) {
                            var d = data[i],
                                o = {};
                            for (var j=0; j<l; j++)
                                o[cols[j]] = d[j];
                            formatted.push(o);
                        }
                        return formatted;
                      }
                      
                      dataTable.data = arrayToJSONObject (data);

                    }, function (error) {
                    console.log(error);
                    })
                  })
                </script>

            <button type="button" class="btn btn-primary simpan">Buat Laporan</button>
            <button type="button" class="btn btn-secondary batal">Batal</button>

          </div>
          
        </div>
      </div>

          </div>
        </div>
      </div>
    </div>
  </div>
<br>
  <div class="text-center">Â© <?php echo date('Y'); ?> Copyright:
      <a href="https://bismaindonesia.com/"> Bisma Indonesai</a>
  </div>

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mask.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="./js/read-excel-file.min.js"></script>
  <script src="./js/formToJson.min.js"></script>
  
  <script type="text/javascript">
    var dataTable = {};
    $(document).ready(function(){
      $('.date').mask('00/00/0000');

      $('.datapelanggan').on('click',function(){
                  var dataURL = $(this).attr('data-href');
                  $('.modal-body').load(dataURL,function(){
                      $('#myModal').modal({show:true});
                  });
              }); 

    });
  </script>
</body>  
</html>  